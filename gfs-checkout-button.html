<script src="../webcomponentsjs/webcomponents.min.js"></script>
<link rel="import" href="../polymer/polymer.html" />
<dom-module id="gfs-checkout-button">

    <template>
        <style>
        </style>

        <div type="submit" class="{{class}}" style="{{style}}">{{text}}</div>

    </template>

    <script>
        Polymer({
            is: "gfs-checkout-button",

            properties: {
                class: {
                    type: String
                },
                style: {
                    type: String
                },
                text: {
                    type: String
                },
                checkoutForm: {
                    type: String
                },
                checkoutWidget: {
                    type: String
                },
                checkoutResults: {
                    type: String
                }
            },

            listeners: {
                tap: 'closeCheckout'
            },

            closeCheckout : function(e) {
                debugger;

                // Get the chosen service details from the widget
                var checkoutWidget = document.getElementById(this.checkoutWidget);
                var checkoutJson = checkoutWidget.getChosenServiceDetails();

                // Fire an Ajax call to the Checkout server to close the checkout session
                checkoutWidget.closeCheckoutRequest();

                // Set the target form field with the selected service details
                var theOutputCtrl = document.getElementById(this.checkoutResults)
                theOutputCtrl.value = btoa(checkoutJson);

                // Submit the target form back to the webserver so it has access to the selected service details
                var theForm = document.getElementById(this.checkoutForm);
                theForm.submit();
            }
        });
    </script>
</dom-module>